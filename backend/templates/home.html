{% extends "base.html" %}
{% block title %}Home - Majorly{% endblock %}
{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/home.css') }}">
{% endblock %}

{% block content %}
<div class="home">
  <!-- Welcome -->
  <div class="welcome-section">
    <h1>Welcome to Majorly</h1>
  </div>

  <!-- Bottom Section: Hobby Suggestions & Search -->
  <div class="bottom-top-section">
    
    <!-- Left: Hobby Input + Suggestions -->
    <div class="left-bottom">
      <div class="hobby-box">
        <input type="text" id="hobby-input" placeholder="Type key word..." />
        <button type="button" onclick="getSuggestions()">Get Suggested Majors</button>
      </div>
      <div id="suggest-container">
        <ul id="suggest-list"></ul>
      </div>
    </div>

    <!-- Right: Search Bar -->
    <div class="right-bottom">
      <div class="search-bar">
        <input type="text" id="search-input" placeholder="Search for a major..." />
        <button type="button" onclick="handleSearch()">Search</button>
      </div>
      <div id="error-message" class="error-page-message"></div>
    </div>

  </div>
</div>

<script>
// ---------------- Suggest Majors (Hobby Keywords) ----------------
async function getSuggestions() {
  const query = document.getElementById('hobby-input').value.trim();
  const listEl = document.getElementById('suggest-list');
  listEl.innerHTML = '';
  document.getElementById('error-message').textContent = '';

  if (!query) return;

  try {
    const response = await fetch(`/suggest?q=${query}`);
    if (!response.ok) throw new Error('Network response not ok');
    const suggestions = await response.json();

    if (suggestions.length === 0) {
      listEl.innerHTML = '<li>No suggestions found</li>';
      return;
    }

    suggestions.forEach(item => {
      const li = document.createElement('li');
      li.textContent = item.name;
      li.onclick = () => window.location.href = `/majorsview/${item.pk}`;
      listEl.appendChild(li);
    });
  } catch (err) {
    console.error(err);
    listEl.innerHTML = '<li>Error fetching suggestions</li>';
  }
}

// ---------------- Search Major ----------------
async function handleSearch() {
  const query = document.getElementById('search-input').value.trim();
  const errorEl = document.getElementById('error-message');
  errorEl.textContent = '';

  if (!query) return;

  try {
    const response = await fetch(`/suggest?q=${query}`);
    if (!response.ok) throw new Error('Network response not ok');
    const results = await response.json();

    if (results.length > 0) {
      // Redirect to first matching major
      window.location.href = `/majorsview/${results[0].pk}`;
    } else {
      errorEl.textContent = 'Major not found!';
    }
  } catch (err) {
    console.error(err);
    errorEl.textContent = 'Error searching for major';
  }
}
</script>
{% endblock %}
