{% extends "base.html" %}

{% block content %}
<h2>Search Results</h2>

<form method="get" action="{% url 'search_major' %}">
    <input type="text" name="q" placeholder="Search for a major..." value="{{ query }}">
    <button type="submit">Search</button>
</form>

{% if major %}
    <h3>{{ major.name }}</h3>
    <p>{{ major.about }}</p>
    <p><strong>Career Prospects:</strong> {{ major.career_prospects }}</p>
    <p><strong>Universities:</strong> {{ major.universities }}</p>

    <h4>Salary in Bahrain (BHD)</h4>
    <ul>
        <li>Entry Level: {{ major.entry_level_salary }}</li>
        <li>Mid Level: {{ major.mid_level_salary }}</li>
        <li>Senior Level: {{ major.senior_level_salary }}</li>
    </ul>

    <h4>Employment Probability</h4>
    <canvas id="employmentChart" width="200" height="200"></canvas>

    <!-- Chart.js CDN -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
      const ctx = document.getElementById('employmentChart').getContext('2d');

      const employRate = parseFloat("{{ major.employability_rate|default:0 }}");
      const remaining = 100 - employRate;

      
      let color;
      if (employRate < 50) {
          color = '#f44336'; 
      } else if (employRate < 80) {
          color = '#ff9800'; 
      } else {
          color = '#4caf50'; 
      }

      new Chart(ctx, {
          type: 'doughnut',
          data: {
              labels: ['Likely Employed', 'Less Likely'],
              datasets: [{
                  data: [employRate, remaining],
                  backgroundColor: [color, '#e0e0e0']
              }]
          },
          options: {
              responsive: true,
              plugins: {
                  tooltip: {
                      callbacks: {
                          label: function(context) {
                              return context.label + ': ' + context.parsed + '%';
                          }
                      }
                  }
              }
          }
      });
    </script>

{% elif not_found %}
    <p style="color:red;">Major not found ‚ùå</p>
{% endif %}
{% endblock %}
